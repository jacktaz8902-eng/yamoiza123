<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>GPS ìë™ ì²´í¬ì¸ ë°ëª¨</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      line-height: 1.6;
    }
    #checkin-status {
      white-space: pre-line;
      margin-top: 15px;
      font-size: 1.1rem;
      color: #333;
    }
  </style>
</head>
<body>
  <h1>GPS ìë™ ì²´í¬ì¸ (GitHub Pages ë²„ì „)</h1>
  <p id="info">GPS ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”...</p>
  <div id="checkin-status"></div>

  <script>
    // â­ ì²´í¬í¬ì¸íŠ¸ ì—¬ëŸ¬ ê°œ ì˜ˆì‹œ
    const checkpoints = [
      {
        id: 1,
        name: "ì²´í¬í¬ì¸íŠ¸ 1 - ì •ë¬¸ ê·¼ì²˜",
        lat: 37.565,
        lon: 126.975,
        radiusM: 50
      },
      {
        id: 2,
        name: "ì²´í¬í¬ì¸íŠ¸ 2 - ë¶„ìˆ˜ëŒ€ ê·¼ì²˜",
        lat: 37.566,
        lon: 126.976,
        radiusM: 50
      }
    ];

    // ì²´í¬ì¸ ê¸°ë¡ ì €ì¥ìš©
    const checkedSet = new Set();

    // ê±°ë¦¬ ê³„ì‚° ê³µì‹ (Haversine)
    function getDistanceFromLatLonInM(lat1, lon1, lat2, lon2) {
      const R = 6371000;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(lat1 * Math.PI / 180) *
        Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) ** 2;

      return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
    }

    const infoEl = document.getElementById('info');
    const statusEl = document.getElementById('checkin-status');

    // â­ ìœ„ì¹˜ ì¶”ì  ì‹œì‘
    if (!navigator.geolocation) {
      infoEl.textContent = "ì´ ë¸Œë¼ìš°ì €ëŠ” GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    } else {
      infoEl.textContent = "í˜„ì¬ ìœ„ì¹˜ë¥¼ ì¶”ì í•˜ëŠ” ì¤‘...";

      navigator.geolocation.watchPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          infoEl.textContent =
            `í˜„ì¬ ìœ„ì¹˜ â†’ ìœ„ë„: ${lat.toFixed(6)}, ê²½ë„: ${lon.toFixed(6)}`;

          let output = "";

          checkpoints.forEach(cp => {
            const distance = getDistanceFromLatLonInM(lat, lon, cp.lat, cp.lon);
            const dTxt = distance.toFixed(1);

            if (distance <= cp.radiusM) {
              if (!checkedSet.has(cp.id)) {
                checkedSet.add(cp.id);
                output += `âœ… [${cp.name}] ìƒˆë¡œ ì²´í¬ì¸ ì„±ê³µ! (ê±°ë¦¬: ${dTxt} m)\n`;
              } else {
                output += `ğŸ“ [${cp.name}] ì´ë¯¸ ì²´í¬ì¸ë¨ (ê±°ë¦¬: ${dTxt} m)\n`;
              }
            } else {
              output += `â¡ï¸ [${cp.name}]ê¹Œì§€ ${dTxt} m ë‚¨ìŒ (ë°˜ê²½ ${cp.radiusM} m)\n`;
            }
          });

          statusEl.textContent = output;
        },
        (err) => {
          infoEl.textContent =
            "GPS ì˜¤ë¥˜: " + err.message + "\n(HTTPS í™˜ê²½ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤)";
        },
        {
          enableHighAccuracy: true,
          maximumAge: 0,
          timeout: 10000
        }
      );
    }
  </script>
</body>
</html>
