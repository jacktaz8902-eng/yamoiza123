<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>GPS ì²´í¬ì¸ - í‰ì°½ë™ ê°€ë‚˜ì•„íŠ¸ì„¼í„°</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      line-height: 1.6;
    }
    #checkin-status {
      white-space: pre-line;
      margin-top: 15px;
      font-size: 1.05rem;
      color: #333;
    }
    #checkinBtn {
      padding: 12px 22px;
      font-size: 1.1rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: #2c7be5;
      color: white;
    }
    #checkinBtn:disabled {
      background: gray;
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ GPS ì²´í¬ì¸ (í‰ì°½ë™ ê°€ë‚˜ì•„íŠ¸ì„¼í„°)</h1>
  <p>ê°€ë‚˜ì•„íŠ¸ì„¼í„° ë°˜ê²½ <b>50m</b> ì•ˆì— ë“¤ì–´ì˜¤ë©´ ì²´í¬ì¸ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</p>

  <p id="info">GPS ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”...</p>

  <!-- â­ ì²´í¬ì¸ ë²„íŠ¼ -->
  <button id="checkinBtn" disabled>ì—¬ê¸°ì„œ ì²´í¬ì¸í•˜ê¸°</button>

  <div id="checkin-status"></div>

  <script>
    const infoEl = document.getElementById('info');
    const statusEl = document.getElementById('checkin-status');
    const checkinBtn = document.getElementById('checkinBtn');

    // â­ ì²´í¬í¬ì¸íŠ¸: í‰ì°½ë™ ê°€ë‚˜ì•„íŠ¸ì„¼í„° (ê³µì‹ ë“±ë¡ ì¢Œí‘œ ê¸°ë°˜)
    const checkpoint = {
      name: "í‰ì°½ë™ ê°€ë‚˜ì•„íŠ¸ì„¼í„°",
      lat: 37.6122099878,
      lon: 126.9751811398,
      radiusM: 50 // ìš”ì²­í•œ 50m ë°˜ê²½
    };

    let currentPos = null;
    let checkedIn = false;

    // ê±°ë¦¬ ê³„ì‚° (Haversine ê³µì‹)
    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371000;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(lat1 * Math.PI / 180) *
        Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) ** 2;

      return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
    }

    // â­ ì²´í¬ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸
    checkinBtn.addEventListener("click", () => {
      if (!currentPos) return;

      const dist = getDistance(
        currentPos.latitude,
        currentPos.longitude,
        checkpoint.lat,
        checkpoint.lon
      );

      if (dist <= checkpoint.radiusM) {
        checkedIn = true;
        checkinBtn.disabled = true;
        statusEl.textContent =
          `âœ… ì²´í¬ì¸ ì„±ê³µ!\n` +
          `[${checkpoint.name}]\n` +
          `í˜„ì¬ ê±°ë¦¬: ${dist.toFixed(1)} m`;
      } else {
        statusEl.textContent =
          `âŒ ì²´í¬ì¸ ì‹¤íŒ¨. ë°˜ê²½ ë°–ì…ë‹ˆë‹¤.\n` +
          `í˜„ì¬ ê±°ë¦¬: ${dist.toFixed(1)} m`;
      }
    });

    // â­ GPS ì¶”ì  ì‹œì‘
    if (!navigator.geolocation) {
      infoEl.textContent = "ì´ ë¸Œë¼ìš°ì €ëŠ” GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    } else {
      infoEl.textContent = "í˜„ì¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...";

      navigator.geolocation.watchPosition(
        (pos) => {
          currentPos = {
            latitude: pos.coords.latitude,
            longitude: pos.coords.longitude
          };

          const lat = currentPos.latitude;
          const lon = currentPos.longitude;

          infoEl.textContent =
            `í˜„ì¬ ìœ„ì¹˜ â†’ ìœ„ë„: ${lat.toFixed(6)}, ê²½ë„: ${lon.toFixed(6)}`;

          const dist = getDistance(lat, lon, checkpoint.lat, checkpoint.lon);
          const dTxt = dist.toFixed(1);

          // ë²„íŠ¼ í™œì„±í™” ì¡°ê±´
          if (!checkedIn && dist <= checkpoint.radiusM) {
            checkinBtn.disabled = false;
          } else if (!checkedIn) {
            checkinBtn.disabled = true;
          }

          // ìƒíƒœ í‘œì‹œ
          statusEl.textContent =
            `ğŸ“ ëª©í‘œì§€ì : ${checkpoint.name}\n` +
            `í˜„ì¬ê±°ë¦¬: ì•½ ${dTxt} m\n` +
            `(ë°˜ê²½ ${checkpoint.radiusM}m ì•ˆì— ë“¤ì–´ì˜¤ë©´ ì²´í¬ì¸ ê°€ëŠ¥)`;
        },
        (err) => {
          infoEl.textContent =
            "GPS ì˜¤ë¥˜ ë°œìƒ: " + err.message + "\n(HTTPS í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•´ì£¼ì„¸ìš”)";
        },
        {
          enableHighAccuracy: true,
          maximumAge: 0,
          timeout: 10000
        }
      );
    }
  </script>
</body>
</html>
